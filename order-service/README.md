# üì¶ Order Service

## –û–ø–∏—Å–∞–Ω–∏–µ

**Order Service** ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏.
–û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –æ—Ç–º–µ–Ω—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ —Ç–∞–∫–∂–µ –∑–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∑–∞–∫–∞–∑–∞–º.

–°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **Go**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **gRPC** –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ **PostgreSQL** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å **Product Service** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö (—Ü–µ–Ω–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ).

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

* üõí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
* üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
* ‚ùå –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
* üìÑ –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –ø–æ ID
* üìö –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
* üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* üìà –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ (Prometheus)
* üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ unit-—Ç–µ—Å—Ç–∞–º–∏

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

* **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: gRPC
* **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: PostgreSQL
* **ORM**: GORM
* **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `slog` (JSON)
* **–ú–µ—Ç—Ä–∏–∫–∏**: Prometheus
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker
* **–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã**:

    * Product Service (gRPC)

### –û–±—â–∞—è —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
[BFF / Client]
        |
      gRPC
        |
   Order Service
        |
      gRPC
        |
  Product Service
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
order-service/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ order/v1/          # gRPC proto + —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ orderservice/      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main.go)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware/        # HTTP middleware (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îÇ   ‚îú‚îÄ‚îÄ model/             # –ú–æ–¥–µ–ª–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ repository/        # –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îî‚îÄ‚îÄ service/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îú‚îÄ‚îÄ api/product/v1/    # gRPC –∫–æ–Ω—Ç—Ä–∞–∫—Ç Product Service
‚îÇ   ‚îî‚îÄ‚îÄ clients/product/   # gRPC –∫–ª–∏–µ–Ω—Ç Product Service
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ README.md
```

---

## gRPC API

### OrderService

```proto
service OrderService {
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  rpc CancelOrder(CancelOrderRequest) returns (CancelOrderResponse);
  rpc UpdateOrder(UpdateOrderRequest) returns (UpdateOrderResponse);
  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
  rpc GetUserOrders(GetUserOrdersRequest) returns (GetUserOrdersResponse);
  rpc GetOrderStats(GetOrderStatsRequest) returns (GetOrderStatsResponse);
}
```

### –ü—Ä–∏–º–µ—Ä: CreateOrder

**Request**

```proto
message CreateOrderRequest {
  int64 user_id = 1;
  repeated OrderItem items = 2;
}
```

**Response**

```proto
message CreateOrderResponse {
  oneof result {
    int64 order_id = 1;
    Error error = 2;
  }
}
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ **gRPC metadata**:

| Header        | –û–ø–∏—Å–∞–Ω–∏–µ           |
| ------------- | ------------------ |
| `x-user-id`   | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è    |
| `x-user-role` | `user` –∏–ª–∏ `admin` |

### –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º–∏ –∑–∞–∫–∞–∑–∞–º–∏**
* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø **–∫–æ –≤—Å–µ–º –∑–∞–∫–∞–∑–∞–º**

---

## –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

* –ó–∞–∫–∞–∑ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å **–º–∏–Ω–∏–º—É–º 1 —Ç–æ–≤–∞—Ä**
* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ > 0
* –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞ —Å—Ç—Ä–æ–≥–æ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ Product Service

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ Prometheus:

* üìä –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
* ‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ë–î
* üîå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* üöÄ gRPC latency

### Endpoints

| Endpoint   | –û–ø–∏—Å–∞–Ω–∏–µ           |
| ---------- | ------------------ |
| `/health`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è |
| `/metrics` | –ú–µ—Ç—Ä–∏–∫–∏ Prometheus |

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è            | –û–ø–∏—Å–∞–Ω–∏–µ              | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é      |
| --------------------- | --------------------- | ----------------- |
| `GRPC_PORT`           | gRPC –ø–æ—Ä—Ç             | `50051`           |
| `MONITORING_PORT`     | HTTP –ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫      | `8082`            |
| `DATABASE_URL`        | PostgreSQL DSN        | `postgres://...`  |
| `PRODUCT_SERVICE_URL` | –ê–¥—Ä–µ—Å Product Service | `localhost:50051` |

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–∫—Ä—ã—Ç–∞ **unit-—Ç–µ—Å—Ç–∞–º–∏**:

* CreateOrder
* GetOrder
* GetUserOrders
* CancelOrder
* UpdateOrder
* GetOrderStats

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **mock-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ Product Service –∫–ª–∏–µ–Ω—Ç–∞.


---

## –ò—Ç–æ–≥

Order Service —Ä–µ–∞–ª–∏–∑—É–µ—Ç:

* —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
* —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
* –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
* –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
* –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + –º–µ—Ç—Ä–∏–∫–∏)
* —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

