# üë§ User & Auth Service

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** –∏ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **–¥–≤—É—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**:

* **User Service** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (CRUD, –≤–∞–ª–∏–¥–∞—Ü–∏—è, gRPC API)
* **Auth Service** ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ JWT

–°–µ—Ä–≤–∏—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ **Go**, –∏—Å–ø–æ–ª—å–∑—É—é—Ç **PostgreSQL**, **gRPC**, **HTTP API**, **JWT**, **Prometheus** –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é **Docker**.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üë§ User Service

* –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
* –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
* –í–∞–ª–∏–¥–∞—Ü–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* HTTP API (Gin)
* gRPC API –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
* Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
* Health-check endpoint
* –ú–µ—Ç—Ä–∏–∫–∏ Prometheus (`/metrics`)
* –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Goose)

### üîê Auth Service

* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT access-—Ç–æ–∫–µ–Ω–æ–≤
* Refresh —Ç–æ–∫–µ–Ω–æ–≤
* –í–∞–ª–∏–¥–∞—Ü–∏—è JWT
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
* Health-check
* –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ **Clean Architecture** –∏ **DDD**:

```
Transport (HTTP / gRPC)
        ‚Üì
Application Services
        ‚Üì
Domain
        ‚Üì
Repository (PostgreSQL)
```

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **Go 1.25**
* **Gin** (HTTP)
* **gRPC**
* **GORM**
* **PostgreSQL**
* **JWT (HS256)**
* **Prometheus**
* **Docker**
* **Goose (–º–∏–≥—Ä–∞—Ü–∏–∏)**

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
user/
‚îú‚îÄ‚îÄ api/                  # gRPC proto + Swagger
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ user/             # User Service (HTTP + gRPC)
‚îÇ   ‚îî‚îÄ‚îÄ user_auth/        # Auth Service
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ app/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ domain/           # Domain –º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/  # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îî‚îÄ‚îÄ transport/        # HTTP –∏ gRPC —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ migrations/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Goose)
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/         # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ jwt/              # JWT –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ logger/           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (zap)
‚îú‚îÄ‚îÄ test/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ Dockerfile            # User Service
‚îú‚îÄ‚îÄ Dockerfile-auth       # Auth Service
‚îî‚îÄ‚îÄ README.md
```

---

## API

### HTTP Endpoints (User Service)

| –ú–µ—Ç–æ–¥ | Endpoint               | –û–ø–∏—Å–∞–Ω–∏–µ                        |
|-------|------------------------|---------------------------------|
| POST  | `/users`               | –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è           |
| GET   | `/users`               | –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π    |
| GET   | `/users/{id}`          | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID    |
| GET   | `/users/email/{email}` | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Email |
| PUT   | `/users/{id}`          | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID     |
| DEL   | `/users/{id}`          | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID      |
| GET   | `/health`              | Health-check                    |
| GET   | `/metrics`             | Prometheus –º–µ—Ç—Ä–∏–∫–∏              |
| GET   | `/swagger/*`           | Swagger UI                      |

---

### gRPC API (User Service)

```proto
service UserService {
  rpc GetUser(GetUserRequest);
  rpc GetUsers(GetUsersRequest);
  rpc ValidateCredentials(ValidateCredentialsRequest);
  rpc UserExists(UserExistsRequest);
}
```

---

### Auth API

| –ú–µ—Ç–æ–¥ | Endpoint         | –û–ø–∏—Å–∞–Ω–∏–µ         |
| ----- | ---------------- | ---------------- |
| POST  | `/auth/login`    | –õ–æ–≥–∏–Ω –∏ JWT      |
| POST  | `/auth/refresh`  | Refresh —Ç–æ–∫–µ–Ω–∞   |
| POST  | `/auth/validate` | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ |
| GET   | `/health`        | Health-check     |

---

## JWT

**Claims:**

* `user_id`
* `email`
* `role`
* `exp`, `iat`, `iss`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

* HS256
* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Goose**.

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞:

```sql
migrations/
‚îú‚îÄ‚îÄ create_users_table.sql
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è Prometheus-–º–µ—Ç—Ä–∏–∫–∏:

* HTTP –∑–∞–ø—Ä–æ—Å—ã
* gRPC –∑–∞–ø—Ä–æ—Å—ã
* –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* –û—à–∏–±–∫–∏

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã:

* User Service (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
* Auth Service (JWT, –ª–æ–≥–∏–Ω)
* gRPC –∫–ª–∏–µ–Ω—Ç
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏