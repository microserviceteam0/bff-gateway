# üß© Shared

–û–±—â–∏–π –º–æ–¥—É–ª—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ **BFF Gateway**, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.

–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º–æ–¥—É–ª—å –≤–∫–ª—é—á–∞–µ—Ç **—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –º–µ—Ç—Ä–∏–∫** –¥–ª—è HTTP, gRPC –∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

---

## üìä Metrics

–ü–∞–∫–µ—Ç `shared/metrics` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ middleware –∏ interceptor'—ã –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ **Prometheus** –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

#### HTTP

* `http_requests_total`
* `http_request_duration_seconds`
* `http_response_size_bytes`
* `http_active_connections`

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:

* `net/http`
* `Gin` middleware

---

#### gRPC

* `grpc_requests_total`
* `grpc_request_duration_seconds`
* `grpc_active_connections`

–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **Unary Server Interceptor**.

---

#### Database

* `db_query_duration_seconds`
* `db_connections`
* `db_errors_total`

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ë–î.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
shared/
‚îú‚îÄ‚îÄ go.mod
‚îî‚îÄ‚îÄ metrics/
    ‚îú‚îÄ‚îÄ database.go          # –ú–µ—Ç—Ä–∏–∫–∏ –ë–î
    ‚îú‚îÄ‚îÄ http.go              # HTTP –º–µ—Ç—Ä–∏–∫–∏
    ‚îú‚îÄ‚îÄ gin_middleware.go    # Gin middleware
    ‚îú‚îÄ‚îÄ mux_middleware.go    # net/http middleware
    ‚îú‚îÄ‚îÄ grpc.go              # gRPC –º–µ—Ç—Ä–∏–∫–∏
    ‚îî‚îÄ‚îÄ grpc_interceptor.go  # gRPC interceptor
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### HTTP (net/http)

```go
handler := metrics.HTTPMetricsMiddleware("product-service")(router)
```

### Gin

```go
r.Use(metrics.GinMetricsMiddleware("product-service"))
```

### gRPC

```go
grpc.NewServer(
    grpc.UnaryInterceptor(
        metrics.GRPCUnaryServerInterceptor("order-service"),
    ),
)
```

---

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

* üì¶ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
* üìä –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –º–µ—Ç—Ä–∏–∫ –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
* üîç –£–ø—Ä–æ—â–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤ Grafana
* üßπ –û—Ç–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## –ò—Ç–æ–≥

–ú–æ–¥—É–ª—å `shared` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Å–Ω–∏–∂–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ.
